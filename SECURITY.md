# Руководство по безопасности Event Manager API

## Обзор мер безопасности

Этот проект включает в себя комплексные меры безопасности для защиты от различных типов атак и обеспечения безопасности данных.

## Реализованные меры безопасности

### 1. Аутентификация и авторизация
- **JWT токены** для аутентификации
- **Bcrypt** для хеширования паролей
- **Блокировка аккаунтов** после множественных неудачных попыток входа
- **Проверка прав доступа** к ресурсам
- **Rate limiting** для предотвращения брутфорс атак

### 2. Защита от атак
- **Helmet.js** для установки безопасных HTTP заголовков
- **CORS** настройка для контроля доступа
- **XSS защита** с очисткой входных данных
- **SQL Injection защита** через Sequelize ORM
- **CSRF защита** через CORS и токены

### 3. Валидация данных
- **Express-validator** для валидации входных данных
- **Санитизация** пользовательского ввода
- **Ограничения размера** запросов
- **Проверка типов данных**

### 4. Логирование безопасности
- **Логирование попыток входа**
- **Отслеживание подозрительной активности**
- **Мониторинг доступа к ресурсам**
- **Детальное логирование ошибок**

### 5. Шифрование данных
- **AES-256-GCM** для шифрования чувствительных данных
- **HMAC** для хеширования с солью
- **Безопасное хранение** паролей

## Настройка переменных окружения

Создайте файл `.env` на основе `.env.example`:

```bash
# Database Configuration
DB_HOST=localhost
DB_USER=postgres
DB_PASSWORD=your-secure-password
DB_NAME=eventdb

# JWT Configuration
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production
JWT_EXPIRES_IN=24h

# Server Configuration
PORT=3000
NODE_ENV=production

# Security Configuration
BCRYPT_ROUNDS=12
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
ENCRYPTION_KEY=your-32-character-encryption-key
ALLOWED_ORIGINS=https://yourdomain.com,https://www.yourdomain.com
```

## Рекомендации по безопасности

### 1. Производственная среда
- Используйте **HTTPS** для всех соединений
- Установите **сильные пароли** для базы данных
- Регулярно **обновляйте зависимости**
- Используйте **reverse proxy** (nginx)
- Настройте **firewall** правила

### 2. Мониторинг
- Регулярно проверяйте **логи безопасности**
- Настройте **алерты** на подозрительную активность
- Мониторьте **попытки взлома**
- Отслеживайте **производительность** системы

### 3. Резервное копирование
- Регулярно создавайте **бэкапы** базы данных
- Храните бэкапы в **безопасном месте**
- Тестируйте **процедуры восстановления**

### 4. Обновления
- Регулярно обновляйте **Node.js** и зависимости
- Следите за **уязвимостями** в используемых пакетах
- Используйте **npm audit** для проверки безопасности

## API Endpoints

### Публичные маршруты
- `POST /api/users/register` - Регистрация пользователя
- `POST /api/users/login` - Вход в систему
- `GET /api/events` - Получение списка событий
- `GET /api/events/:id` - Получение события по ID
- `GET /api/comments/event/:eventId` - Получение комментариев события

### Защищенные маршруты
Все остальные маршруты требуют аутентификации через JWT токен в заголовке:
```
Authorization: Bearer <your-jwt-token>
```

## Примеры использования

### Регистрация пользователя
```bash
curl -X POST http://localhost:3000/api/users/register \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Иван Иванов",
    "email": "ivan@example.com",
    "password": "SecurePass123"
  }'
```

### Вход в систему
```bash
curl -X POST http://localhost:3000/api/users/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "ivan@example.com",
    "password": "SecurePass123"
  }'
```

### Создание события (требует аутентификации)
```bash
curl -X POST http://localhost:3000/api/events \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <your-jwt-token>" \
  -d '{
    "title": "Мое событие",
    "description": "Описание события",
    "date": "2024-12-31T18:00:00.000Z"
  }'
```

## Мониторинг безопасности

Логи безопасности сохраняются в директории `logs/` с именем файла в формате `security-YYYY-MM-DD.log`.

### Типы событий в логах:
- `info` - Успешные операции
- `warn` - Подозрительная активность
- `error` - Ошибки безопасности

### Пример лога:
```json
{
  "timestamp": "2024-01-15T10:30:00.000Z",
  "level": "warn",
  "message": "Обнаружена подозрительная активность",
  "metadata": {
    "ip": "192.168.1.100",
    "userAgent": "Mozilla/5.0...",
    "path": "/api/events",
    "method": "POST",
    "suspiciousField": "body.title",
    "suspiciousValue": "<script>alert('xss')</script>"
  }
}
```

## Контакты

При обнаружении уязвимостей безопасности, пожалуйста, свяжитесь с командой разработки.
